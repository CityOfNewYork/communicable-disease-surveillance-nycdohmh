# Detecting COVID-19 Clusters With High PCR Test Percent Positivity

## Project File Inventory

### `BCD005_COVID_Master.sas` – assigns folder and library locations, calls `BCD005_COVID_Macros.sas`, calls `BCD005_COVID_Analysis.sas`, parses result table, sends e-mails

### `BCD005_COVID_Analysis.sas` – calls all `BCD005_COVID_ANALYSIS` sas files, defines macro variables for each set of analysis parameters, runs iterative SaTScan analyses

### `BCD005_COVID_ANALYSIS_data_prep.sas` - imports and formats COVID data

### `BCD005_COVID_ANALYSIS_citywide_percent_positivity_graphs.sas` - calculates citywide trend in percent positivity and outputs figure

### `BCD005_COVID_ANALYSIS_satscan_input_files.sas` - generates input files for each iterative SaTScan analysis

### `BCD005_COVID_Macros.sas` – calls all `BCD005_COVID_MACRO` sas files to load macros

### `BCD005_COVID_MACRO_param.sas` - defines parameters for each unique SaTScan analysis

### `BCD005_COVID_MACRO_personlinelist_setup.sas` - sets up the data for the person linelist

### `BCD005_COVID_MACRO_choropleth_setup.sas` - sets up the data for the cluster map

### `BCD005_COVID_MACRO_clustersummary_setup.sas` - sets up the data for cluster summary tables

### `BCD005_COVID_MACRO_makepersonlinelist.sas` - exports person linelist to excel file

### `BCD005_COVID_MACRO_makechoropleth.sas` - starts creating RTF output file, prints choropleth map first

### `BCD005_COVID_MACRO_makeclustersummary.sas` - prints cluster summary tables to RTF output file

### `BCD005_COVID_MACRO_maketemporalgraphs.sas` - generate temporal graph for each cluster for RTF output

### `BCD005_all_labs_geocoded.sas7bdat` - sample dataset (patient data are fake and provided for illustration only) including unique case id (event_ID), case and investigation status, geographic unit of analysis (census tract) and associated neighborhood name, clinical information (date of positive/negative test, symptomatic yes/no), and demographics (age, sex, race, ethnicity)

### `BCD005_Clusterhistory_covid.sas7bdat` – archive of output from daily runs of SaTScan, stores clusters meeting or exceeding the recurrence interval (RI) threshold, or the most likely cluster if none exceed the RI threshold

### `BCD005_Satscanlinelist_covid.sas7bdat` – archive of events identified as part of a cluster exceeding the RI threshold

### `BCD005_NYC_censustracts.sas7bdat` - sample coordinate file, with census tract ID and X/Y coordinates of NYC census tract centroids

### `BCD005_Diseaselist.xlsx` – Excel table of modifiable analysis parameters. The analysis_print column acts as a unique identifier for each set of unique analysis parameters. The column is defined by the user must a) conform to SAS dataset naming conventions (only alphanumeric characters, no spaces), b) not exceed 20 characters, and c) not duplicate a value within a set of iterative analyses. In the example provided here we use a combination of analysis parameters that allow users to easily identify the parameter settings used for each set of output (e.g. where analysis_print=poisson_np_63_rr24: model type=poisson-based prospective space-time, spatial adjustment=non-parametric, study period=63 days, relative risk threshold=2.4)

### `BCD005_nyct2010.shp/dbf/prj/shx` – NYC census tract-level shapefile (4 files)

### `BCD005_satscan_COVID_poisson_np_63_rr24_20201122.pdf` - sample output using fake simulated data


## General guidelines for adaptation

### The prospective cluster detection method using SaTScan to identify areas of elevated percent positivity applied by NYC DOHMH to support COVID-19 response efforts is described in [this preprint](https://www.medrxiv.org/content/10.1101/2020.07.18.20156901v2), published on medRxiv in August 2020.

### This code runs SaTScan in batch mode. [SaTScan](https://www.satscan.org) is freely downloadable. Depending on organizational IT security policies, execution of batch files might be restricted to users with administrator permissions or only allowed on specially configured workstations (e.g., via a secure virtual machine or on a workstation without an internet connection).

### This code makes extensive use of macro variables and programming to minimize the number of changes required when modifying folder locations, analysis parameters, etc. All user-defined macro variables that set folder locations and libnames referenced throughout the code are found in the first 55 lines of `BCD005_COVID_Master.sas`.

### As currently configured, the code primarily references two subfolders within a main “SaTScan” folder: a “supportingfiles” subfolder and an “archive” subfolder. The former is referenced as the location of all sample datasets, table shells, and other supporting files. The latter is used to store all input and output files generated by the program.

### To ease adoption of this code we have included a sample dataset with fake patient data along with table shells, shapefiles, and other supporting files. When folder/libname locations are correctly defined and permission is granted to execute x commands and batch files, a user should be able to replicate the sample RTF output included in the project by running the full program.

### NYC DOHMH uses 2010 census tract as the geographic unit of aggregation for these analyses. If you wish to adopt to use a different geographic unit, please note that the variables 'tract' and 'censustract' will need to be modified throughout the code. Additionally, the boundaries of the shapefile used as the base map in the RTF output must match the geographic unit of interest.
