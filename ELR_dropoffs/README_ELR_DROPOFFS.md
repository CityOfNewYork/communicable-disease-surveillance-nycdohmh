# Detecting Dropoffs in Electronic Laboratory Reporting
## Project File Inventory
### `BCD001_ELR_Dropoff_SaTScan_Master.sas` - Assigns folder and library locations, calls `BCD001_ELR_Dropoff_SaTScan_Parameters.sas` to set parameters and `BCD001_ELR_Dropoff_SaTScan_Analysis.sas` to run analyses, generates output, sends e-mails
### `BCD001_ELR_Dropoff_SaTScan_Analysis.sas` - Imports and formats data, runs SaTScan analyses, imports results, formats for output,  applies suppression rules to identified drop-off signals
### `BCD001_ELR_Dropoff_SaTScan_Parameters.sas` - Sets SaTScan parameter settings to detect lab-specific clusters of low reporting overall, for specific diseases, and for specific test types
### `BCD001_disease_parameters.xlsx` - Catalog of disease-level parameter settings used in analyses to detect reporting drop-offs in specific diseases that is easily modified by user
### `BCD001_disease_parameters.sas7bdat` - Catalog of disease-level parameter settings referenced in analysis code
### `BCD001_Update disease_parameters supporting file.sas` - Code to update disease-level parameter settings dataset to reflect changes to excel file
### `BCD001_disease_names.sas7bdat` - example of reference table with disease severity and disease type
### `BCD001_facility_addresses.sas7bdat` - example of reporting facility reference table
### `BCD001_dropoff_history.sas7bdat` - empty formatted dataset to store signal history

## General guidelines for adaptation
### To avoid delays in case and outbreak detection, it is critical to quickly recognize when any laboratory fails to report test results for one or more diseases for an unusually long period. For more details about these analyses to automatically detect and summarize reporting drop-offs, please refer to [this article](https://journals.lww.com/jphmp/Abstract/publishahead/Detecting_Drop_offs_in_Electronic_Laboratory.99408.aspx) published in the Journal of Public Health Management and Practice in 2019.
### This code runs SaTScan in batch mode. [SaTScan](https://www.satscan.org) is freely downloadable. Depending on organizational IT security policies, execution of batch files might be restricted to users with administrator permissions or only allowed on specially configured workstations (e.g. via a secure virtual machine or on a workstation without an internet connection). 
### This code makes extensive use of macro variables and programming to minimize the number of changes required when modifying folder locations, analysis parameters, etc. All macros defined in the code that require user modification are found in the first 30 lines of `BCD001_ELR_Dropoff_SaTScan_Master.sas`. The code in this file also sets all SaTScan analysis parameters and runs all analyses by reading in `BCD001_ELR_Dropoff_SaTScan_Parameters.sas` and `BCD001_ELR_Dropoff_SaTScan_Analysis.sas`, respectively, then evaluates the identified signals to generate output and send emails, when appropriate.
### `BCD001_ELR_Dropoff_SaTScan_Parameters.sas` should require no modification unless a user wishes to adjust SaTScan parameters that remain constant in the analysis as currently defined.
### `BCD001_ELR_Dropoff_SaTScan_Analysis.sas` will likely require the most modification to adapt to other surveillance databases or data streams, especially the sections that import and modify data. Rather than try and cover all the possible modifications that might be required for other jurisdictions, we will highlight illustrative features and caveats of the code as adapted for the NYC disease surveillance system, which might or might not be applicable for other jurisdictions. These include:
### - The NYC DOHMH uses separate databases for disease surveillance (Maven) and electronic lab reporting (ECLRS). Our analyses primarily use Maven data, which is imported from ECLRS after going through automated QA and standardization processes, to identify potential drop-offs in reporting and to assess past reporting patterns. ECLRS is used as a secondary data source in applying signal suppression rules.
### - "CLIA" is a unique lab identifier, assigned by the Centers for Medicare and Medicaid Services, and is a required field for reporting labs in New York State. A unique lab identifier for each facility included in the analysis that is consistent throughout the study period is essential to obtaining accurate results.
### - When labs merge, send out testing to other labs, assign identifiers to nonstandard fields, or change unique identifiers, the analysis may produce signals indicating drop-offs that do not indicate a reporting error. Reports from the affected lab may need to be assigned to another CLIA in the code to preserve comparability of baseline and current counts of reporting. Examples of CLIA reassignment for all results and specific diseases/tests can be found at lines 36-45, 159-165, 200-209, and 233-238 in  `BCD001_ELR_Dropoff_SaTScan_Analysis.sas`.

